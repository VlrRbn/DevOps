# Managed by Ansible (role: nginx_reverse_proxy)
upstream lab_backend {
    server {{ nginx_backend_host }}:{{ nginx_backend_port }};
    keepalive 16;
}

server {
    listen {{ nginx_listen_http }} default_server;
    listen [::]:{{ nginx_listen_http }} default_server;
    server_name localhost 127.0.0.1;

    access_log {{ access_log_json }} json;
    server_tokens off;

    location = {{ nginx_reverse_proxy_health_path }} {
	return 200 "OK\n";
	add_header Content-Type text/plain;
    }

    location / {
	proxy_set_header Host			$host;
	proxy_set_header X-Real-IP		$remote_addr;
	proxy_set_header X-Forwarded-For	$proxy_add_x_forwarded_for;
	proxy_set_header X-Forwarded-Proto	$scheme;
	proxy_http_version 1.1;
	proxy_set_header Connection "";
	proxy_pass http://lab_backend;
    }
}
