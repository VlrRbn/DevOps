# Linux_Files_and_Search

---

## Навигация по каталогам

| Команда | Что делает | Зачем / Пример |
| --- | --- | --- |
| `pwd` | Показать текущий путь | Проверить контекст перед `rm`/`mv` |
| `cd DIR` | Перейти в каталог | `cd /etc/nginx` |
| `cd` / `cd ~` | Домашний каталог | `cd ~/Downloads` |
| `cd ..` / `cd ../..` | На 1–2 уровня вверх | Быстро подняться по дереву |
| `cd -` | Назад в предыдущий каталог | Переключаться между двумя путями |
| `pushd DIR` / `popd` | Стек каталогов | Обход нескольких директорий по кругу |

**Подводные камни:** пути с пробелами → кавычки: `cd "/path/with spaces"`.

---

## Листинг и метаданные

| Команда | Что делает | Зачем / Пример |
| --- | --- | --- |
| `ls -la` | Подробный листинг, скрытые файлы | Смотреть права/владельца/дату |
| `ls -lh` | Человекочитаемые размеры | Сравнивать размеры файлов |
| `stat FILE` | Полные метаданные файла | Проверить inode, времена atime/mtime/ctime |
| `file FILE` | Тип содержимого | Понять двоичный/текстовый/архив |
| `tree -L 2` | Дерево каталогов (пакет `tree`) | Быстро увидеть структуру |

**Лайфхак:** `ls -l --time-style=long-iso` для стабильного формата дат.

---

## Создание/изменение/удаление

| Команда | Что делает | Зачем / Пример |
| --- | --- | --- |
| `touch file` | Создать пустой файл / обновить mtime | Заглушки, триггеры |
| `mkdir -p a/b/c` | Создать вложенные каталоги | Без ошибок, если уже есть |
| `rmdir dir` | Удалить **пустой** каталог | Чистка пустых директорий |
| `cp -a SRC DST` | Копия с атрибутами (рекурсивно) | Бэкап/миграция без потери прав |
| `mv SRC DST` | Переместить / переименовать | Рефактор структуры |
| `rm -i file` | Удаление с подтверждением | Защита от случайностей |
| `rm -r dir` | Рекурсивное удаление | Чистка деревьев |
| `rm -rf dir` | Жёсткое удаление без вопросов | **Опасно** — используйте осознанно |

**Подводные камни:**

- Пробелы/спецсимволы → всегда кавычки: `rm -i -- "weird name (1).txt"`

- `rm -rf /` — защищено современными `rm`, но **никогда** не играться с корнями; для безопасности добавить alias `rm='rm -i'` (или `--preserve-root`).

---

## Права и владельцы (важно для файлов!)

| Команда | Что делает | Зачем / Пример |
| --- | --- | --- |
| `chmod 640 file` | Права в восьмеричном виде | Быстро задать режим |
| `chmod u+rw,g+r,o- file` | Символьный синтаксис | Точно добавить/убрать флаги |
| `chown user:group path -R` | Сменить владельца/группу | После копий/распаковок |
| `umask` | Базовые права для новых файлов | Контроль по умолчанию |
| `getfacl / setfacl` | ACL (расширенные права) | Тонкая раздача доступа |

**Подводные камни:** ACL может «переехать» поверх обычных прав — проверять `getfacl` если поведение неожиданное.

---

## Просмотр содержимого файлов

| Команда | Что делает | Зачем / Пример |
| --- | --- | --- |
| `less -S file` | Постраничный просмотр, `-S` не переносить строки | Идеально для логов/конфигов |
| `/pattern` / `n` в `less` | Поиск вперёд / следующее совпадение | Быстро находить строки |
| `head -n 50 file` | Первые N строк | Посмотреть заголовок/формат |
| `tail -n 100 file` | Последние N строк | Хвост логов |
| `tail -f file` | Следить за изменениями | Лайв-мониторинг |
| `zless file.gz` | Просмотр сжатого | Исторические логи |

**Лайфхак:** `less +F file` — «почти tail -f», можно вернуться в обычный режим `Ctrl+C`.

---

## Поиск файлов (имена, свойства)

| Команда | Что делает | Зачем / Пример |
| --- | --- | --- |
| `find DIR -name "*.log"` | По имени (шаблон) | Найти логи |
| `find DIR -type f -size +100M` | По размеру | Охота на «жрунов» |
| `find DIR -mtime -1` | По времени модификации | Что менялось за сутки |
| `find DIR -user root -perm -4000` | SUID-файлы | Аудит безопасности |
| `find DIR -maxdepth 2 -mindepth 2 -type d` | Глубина поиска | Точная выборка |
| `locate filename` | Быстрый индексированный поиск | В 100× быстрее `find` (нужен `updatedb`) |
| `which cmd` / `type -a cmd` | Где команда / как интерпретатор её найдёт | Диагностика PATH |
| `whereis cmd` | Бинарь + man + исходники | Полезно для админов |

**Подводные камни:** `locate` ищет в **индексе** → обновлять `sudo updatedb` (пакет `plocate`).

---

## Поиск текста (содержимое)

| Команда | Что делает | Зачем / Пример |
| --- | --- | --- |
| `grep -RIn --color PATTERN DIR` | Рекурсивный поиск строк | Находить ошибку в коде/логах |
| `grep -i` / `-v` | Игнор регистра / инверсия | Гибкая фильтрация |
| `grep -E 'foo|bar'` | Расширенные регэкспы | Множественные варианты |
| `zgrep PATTERN file.gz` | Поиск в сжатых логах | История, которую не разархивируешь |

**Лайфхаки:**

- Безопасно передавать паттерн: `grep -F "literal*text"` (без регэкспа).

- Исключать директории: `grep -R --exclude-dir .git PATTERN .`

---

## Комбинации find + xargs / -exec

| Приём | Что делает | Пример |
| --- | --- | --- |
| `find … -print0 | xargs -0 cmd` | Безопасно передаёт имена с пробелами | `find DIR -name "*.log" -print0 | xargs -0 grep -H "ERROR"` |
| `find … -exec cmd {} +` | Пакетно передаёт несколько файлов | `find DIR -type f -name "*.tmp" -exec rm -f {} +` |
| `find … -exec cmd {} \;` | По одному файлу | `-exec chmod 640 {} \;` |

```bash
# По одному файлу (создаёт процесс на КАЖДЫЙ файл)
find DIR -type f -exec chmod 640 {} \;
```

`-exec cmd {} \;` — запустить **cmd один раз на каждый найденный файл**. `{}` заменяется на путь, `\;` — экранированная точка с запятой (чтобы shell не съел).

**Подводные камни:** Предпочтительнее `-print0 | xargs -0` или `-exec … +` → защищает от пробелов/переводов строки в именах.

---

## Сравнение и контроль целостности

| Команда | Что делает | Зачем / Пример |
| --- | --- | --- |
| `diff -u file1 file2` | Построчное сравнение | Разница конфигов/скриптов |
| `cmp -s a b` | Быстро проверить идентичность | Возвращает код 0/1 |
| `md5sum file` / `sha256sum file` | Хэш-суммы | Проверка скачиваний/бэкапов |
| `comm -12 <(sort a) <(sort b)` | Пересечение списков | Анализ каталогов/лисов |

---

## Копирование, архивы, синхронизация

| Команда | Что делает | Зачем / Пример |
| --- | --- | --- |
| `cp -a SRC DST` | Копия с сохранением атрибутов | Миграции/бэкапы |
| `rsync -aP SRC/ DST/` | Синхронизация + прогресс | Надёжная передача больших объёмов |
| `rsync -aAX --delete SRC/ DST/` | Архивный режим + xattrs/ACL | Почти зеркалирование |
| `scp file user@host:/path` | Копия по SSH | Быстрая передача на сервер |
| `tar czf backup.tgz DIR/` | Архивирование в .tar.gz | Резервные копии |
| `tar xf backup.tgz -C /restore` | Распаковка | Восстановление |

**Подводные камни:**

- `rsync SRC DST` vs `rsync SRC/ DST/` — слеш влияет на семантику (внутренности vs каталог).

- С `--delete` осторожно: удалит то, чего нет в источнике.

---

## Размеры и место на диске

| Команда | Что делает | Зачем / Пример |
| --- | --- | --- |
| `du -sh * | sort -h` | Размеры директорий | Найти, что занимает место |
| `df -h` | Свободное место по ФС | Мониторинг дисков |
| `ls -lSh` | Отсортировать файлы по размеру | Быстро найти «тяжёлые» |

---

## Паттерны оболочки (globbing/brace/quoting)

| Приём | Что делает | Пример |
| --- | --- | --- |
| Globbing | Шаблоны имён | `ls *.log`, `rm data-2025-??-*.csv` |
| Brace expansion | Генерация списков | `touch file{1..5}.txt` |
| Кавычки | Защита пробелов/символов | `mv "weird name.txt" safe.txt` |

---

## Практикум

1. Локализовать «прожорливые» директории:
    
    ```bash
    du -sh /* 2>/dev/null | sort -h | tail -10
    ```
    

1. Найти большие файлы > 500M и вывести топ-10:
    
    ```bash
    find / -xdev -type f -size +500M -printf '%s %p\n' 2>/dev/null | sort -nr | head -10
    ```
    

1. Найдти ошибки в логах nginx за сегодня:
    
    ```bash
    grep -RIn --color -E 'error|crit|alert' /var/log/nginx
    ```
    

1. Синхронизировать конфиги с бэкапом (dry-run):
    
    ```bash
    rsync -aAXvn --delete /etc/ /backup/etc/
    ```
    

---

## Security Checklist

- Перед `rm -r` → смотреть **`pwd`** и сделать `ls` того, что будем удалять.
- Использовать кавычки и `-` перед именами, начинающимися с : `rm -- "-file"`
- Для массовых операций по результатам `find` → `print0 | xargs -0` или `exec … +`.
- Делать «сухой прогон»: `echo rsync …` или `rsync -n` перед настоящим запуском.
- Даты и резервные копии: `tar czf backup-$(date +%F).tgz DIR`.

---

## Быстрые блоки

```bash
# 1) Рекурсивно найти файлы по имени (без учёта регистра)
find . -type f -iname '*config*'

# 2) Найти строку во всех текстовых файлах, исключая 
.gitgrep -RIn --exclude-dir .git 'Listen 80' .

# 3) Сравнить два каталога (списками)
diff -ruN dirA/ dirB/

# 4) Скопировать с прогрессом и сохранить атрибуты
rsync -aP source/ dest/

# 5) Топ-10 самых больших файлов в текущем дереве
find . -type f -printf '%s\t%p\n' | sort -nr | head -10
```